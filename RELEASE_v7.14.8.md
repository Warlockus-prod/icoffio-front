# üêõ RELEASE v7.14.8 - Language Filter Fix

**–î–∞—Ç–∞:** 2025-11-03  
**–¢–∏–ø:** BUGFIX (PATCH)  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** HIGH - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π UX –±–∞–≥

---

## üêõ –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

–ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –ù–ï —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª–∏—Å—å –ø–æ —è–∑—ã–∫—É:
- ‚ùå –ù–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–π –≤–µ—Ä—Å–∏–∏ `/en` –º–æ–≥–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –ø–æ–ª—å—Å–∫–∏–µ —Å—Ç–∞—Ç—å–∏ —Å `-pl`
- ‚ùå –ù–∞ –ø–æ–ª—å—Å–∫–æ–π –≤–µ—Ä—Å–∏–∏ `/pl` –º–æ–≥–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å—Ç–∞—Ç—å–∏ —Å `-en`
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥–µ–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –Ω–∞ —Ç–æ–º —è–∑—ã–∫–µ

**Root Cause:** –§—É–Ω–∫—Ü–∏—è `getPopularArticles()` –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–ª–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä `locale`

---

## ‚úÖ –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. `lib/supabase-analytics.ts`
```typescript
// –ë–´–õ–û:
export async function getPopularArticles(limit: number = 10): Promise<string[]>

// –°–¢–ê–õ–û:
export async function getPopularArticles(limit: number = 10, locale?: string): Promise<string[]>
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `locale?: string`
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—É—Ñ—Ñ–∏–∫—Å—É `-en` –∏–ª–∏ `-pl` —á–µ—Ä–µ–∑ SQL `.like()`
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –æ–±–æ–∏—Ö —è–∑—ã–∫–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `üåç Filtering for locale: en/pl`

### 2. `app/[locale]/(site)/page.tsx`
```typescript
// –ë–´–õ–û:
const popularSlugs = await getPopularArticles(12);

// –°–¢–ê–õ–û:
const popularSlugs = await getPopularArticles(12, params.locale);
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è `params.locale` –≤ —Ñ—É–Ω–∫—Ü–∏—é
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –æ–±–æ–∏—Ö —è–∑—ã–∫–æ–≤ (en –∏ pl)

### 3. `app/api/analytics/popular-articles/route.ts`
```typescript
// –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä:
const locale = searchParams.get('locale') || undefined;

// –í–∞–ª–∏–¥–∞—Ü–∏—è:
if (locale && !['en', 'pl'].includes(locale)) {
  return NextResponse.json({ error: 'Locale must be either "en" or "pl"' }, { status: 400 });
}

// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:
if (locale) {
  query = query.like('article_slug', `%-${locale}`);
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ API —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `?locale=en` –∏–ª–∏ `?locale=pl`
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è en/pl
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ SQL LIKE

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### Build Test ‚úÖ
```bash
npm run build
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üåç Filtering 12 articles for locale: en
‚úÖ Article matched for EN: ai-revolution-2024-en
‚úÖ Article matched for EN: apple-vision-pro-review-en
üö´ Excluded from EN: ai-revolution-2024-pl (contains non-English characters)
üìä Filtered 6/12 articles for en
```

### –ê–Ω–≥–ª–∏–π—Å–∫–∞—è –≤–µ—Ä—Å–∏—è (EN):
1. ‚úÖ –û—Ç–∫—Ä—ã—Ç—å https://app.icoffio.com/en
2. ‚úÖ –í—Å–µ —Å—Ç–∞—Ç—å–∏ –¥–æ–ª–∂–Ω—ã –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ `-en`
3. ‚úÖ –ù–µ—Ç —Å—Ç–∞—Ç–µ–π —Å `-pl`

### –ü–æ–ª—å—Å–∫–∞—è –≤–µ—Ä—Å–∏—è (PL):
1. ‚úÖ –û—Ç–∫—Ä—ã—Ç—å https://app.icoffio.com/pl
2. ‚úÖ –í—Å–µ —Å—Ç–∞—Ç—å–∏ –¥–æ–ª–∂–Ω—ã –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ `-pl`
3. ‚úÖ –ù–µ—Ç —Å—Ç–∞—Ç–µ–π —Å `-en`

---

## üìä IMPACT

### –î–æ:
- ‚ùå –°–º–µ—à–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ –æ–±–æ–∏—Ö —è–∑—ã–∫–∞—Ö
- ‚ùå –ü–ª–æ—Ö–æ–π UX
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —è–∑—ã–∫

### –ü–æ—Å–ª–µ:
- ‚úÖ –°—Ç—Ä–æ–≥–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —è–∑—ã–∫—É
- ‚úÖ –û—Ç–ª–∏—á–Ω—ã–π UX
- ‚úÖ –ö–∞–∂–¥–∞—è –≤–µ—Ä—Å–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–π —è–∑—ã–∫
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –¥–ª—è en –ò pl

---

## üéØ –ù–û–í–û–ï –ü–†–ê–í–ò–õ–û –†–ê–ó–†–ê–ë–û–¢–ö–ò

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –¥–ª—è –≤—Å–µ—Ö –±—É–¥—É—â–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç–æ–∫:**

> –í—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–Ω–µ–¥—Ä—è—Ç—å –¥–ª—è **–î–í–£–• —è–∑—ã–∫–æ–≤ —Å—Ä–∞–∑—É** (en –ò pl)

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ñ–∏—á:
1. ‚úÖ –í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `locale` –≤ —Ñ—É–Ω–∫—Ü–∏–∏
2. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ **–û–ë–û–ò–•** —è–∑—ã–∫–∞—Ö
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ `-en` –∏ `-pl`
4. ‚úÖ –î–æ–±–∞–≤–ª—è—Ç—å –ø–µ—Ä–µ–≤–æ–¥—ã –≤ `lib/i18n.ts` –¥–ª—è –æ–±–æ–∏—Ö —è–∑—ã–∫–æ–≤
5. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —è–∑—ã–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

---

## üìù –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–ê–ô–õ–´

1. ‚úÖ `lib/supabase-analytics.ts` - –¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä locale
2. ‚úÖ `app/[locale]/(site)/page.tsx` - –ø–µ—Ä–µ–¥–∞—á–∞ locale
3. ‚úÖ `app/api/analytics/popular-articles/route.ts` - —Ñ–∏–ª—å—Ç—Ä –ø–æ locale
4. ‚úÖ `package.json` - –≤–µ—Ä—Å–∏—è 7.14.7 ‚Üí 7.14.8
5. ‚úÖ `LANGUAGE_FILTER_FIX.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## üöÄ DEPLOYMENT

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞
npm run build  # ‚úÖ Passed

# –ö–æ–º–º–∏—Ç
git add -A
git commit -m "üêõ v7.14.8: Language Filter Fix - Popular Articles –ø–æ —è–∑—ã–∫–∞–º"
git tag v7.14.8
git push origin main --tags

# Vercel deploy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

---

## ‚úÖ CHECKLIST

- [x] –ö–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω –¥–ª—è –æ–±–æ–∏—Ö —è–∑—ã–∫–æ–≤ (en –ò pl)
- [x] Build –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
- [x] TypeScript 0 errors
- [x] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
- [x] API –æ–±–Ω–æ–≤–ª–µ–Ω
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [x] –í–µ—Ä—Å–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [x] –ü—Ä–∞–≤–∏–ª–æ –Ω–∞ –±—É–¥—É—â–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ READY FOR PRODUCTION  
**Semantic Versioning:** 7.14.7 ‚Üí 7.14.8 (PATCH - bugfix)  
**Breaking Changes:** –ù–µ—Ç  
**Migration Required:** –ù–µ—Ç

**–°–ª–µ–¥—É—é—â–∞—è –≤–µ—Ä—Å–∏—è:** v7.14.9 –∏–ª–∏ v7.15.0

