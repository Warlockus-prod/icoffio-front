# üîß TELEGRAM INTEGRATION FIX v8.7.5

**Date:** December 8, 2025  
**Version:** v8.7.5  
**Type:** PATCH (Critical Telegram bot fixes)

## üî¥ –ü–†–û–ë–õ–ï–ú–´ –û–ë–ù–ê–†–£–ñ–ï–ù–´

### 1. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** Telegram –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `'ai'`, –Ω–æ API –æ–∂–∏–¥–∞–µ—Ç `'dalle'`  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ "AI" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

### 2. ‚ùå Hero –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–æ—Å—å
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å—Ç–∞–≤–ª—è–ª–∏—Å—å –≤ –∫–æ–Ω—Ç–µ–Ω—Ç, –Ω–æ `image_url` –≤ –ë–î –±—ã–ª `null`  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ç–∞—Ç—å–∏ –ø—É–±–ª–∏–∫–æ–≤–∞–ª–∏—Å—å –±–µ–∑ –ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

### 3. ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å –ø–æ—á–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

### 4. ‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ë–î –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏—Å—å  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–æ–≥–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–µ–≤–µ—Ä–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. ‚úÖ –ú–∞–ø–ø–∏–Ω–≥ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
**–§–∞–π–ª:** `lib/telegram-simple/image-generator.ts`
- –î–æ–±–∞–≤–ª–µ–Ω –º–∞–ø–ø–∏–Ω–≥: `'ai'` ‚Üí `'dalle'` –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º API
- –¢–µ–ø–µ—Ä—å Telegram –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç API

```typescript
// ‚úÖ FIX: Map Telegram settings source to API source
const apiSource = source === 'ai' ? 'dalle' : source;
```

### 2. ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Hero –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
**–§–∞–π–ª:** `lib/telegram-simple/publisher.ts`
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∫–∞–∫ hero image
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–æ–ª–µ `image_url` –≤ Supabase
- Fallback –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –µ—Å–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å

```typescript
// Extract first image URL from content as hero image
const imageUrlMatch = finalContentEn.match(/!\[.*?\]\((https?:\/\/[^\s\)]+)\)/);
if (imageUrlMatch && imageUrlMatch[1]) {
  heroImage = imageUrlMatch[1];
}
```

### 3. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
**–§–∞–π–ª—ã:** 
- `lib/telegram-simple/image-generator.ts` - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- `app/api/telegram-simple/webhook/route.ts` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
- `lib/telegram-simple/settings-loader.ts` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### 4. ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
**–§–∞–π–ª:** `lib/telegram-simple/settings-loader.ts`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `imagesCount` (0-3)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `imagesSource` (unsplash/ai/none)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è –Ω–µ–≤–µ—Ä–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –Ø–≤–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –∏–∑ –ë–î

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Vercel:**
   ```
   [SettingsLoader] ‚úÖ Loaded settings from DB: {
     imagesCount: 2,
     imagesSource: 'unsplash',
     contentStyle: 'journalistic'
   }
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
   ```
   [TelegramImages] Generating 2 images from unsplash...
   [TelegramImages] ‚úÖ Generated 2/2 images successfully
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ hero image:**
   ```
   [TelegramSimple] ‚úÖ Extracted hero image: https://images.unsplash.com/...
   ```

## üìã –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–ê–ô–õ–´

1. `lib/telegram-simple/image-generator.ts`
   - –ú–∞–ø–ø–∏–Ω–≥ `'ai'` ‚Üí `'dalle'`
   - –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ `success` —Ñ–ª–∞–≥–∞ –≤ –æ—Ç–≤–µ—Ç–µ API

2. `lib/telegram-simple/publisher.ts`
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ hero image –∏–∑ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ `image_url` –≤ Supabase
   - Fallback –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

3. `lib/telegram-simple/settings-loader.ts`
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–∫
   - –Ø–≤–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

4. `app/api/telegram-simple/webhook/route.ts`
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏: `imagesCount: 3`, `imagesSource: 'ai'`
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –±–æ—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å 3 –∑–∞–ø—Ä–æ—Å–∞ –∫ DALL-E API

### –¢–µ—Å—Ç 2: Hero –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
1. –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å—é —á–µ—Ä–µ–∑ Telegram
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Supabase: –ø–æ–ª–µ `image_url` –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å URL
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Å–∞–π—Ç–µ: —Å—Ç–∞—Ç—å—è –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å –ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

### –¢–µ—Å—Ç 3: –°—Ç–∏–ª—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `contentStyle: 'casual'` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –≤ –±–æ—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –∫–æ–Ω—Ç–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ casual —Å—Ç–∏–ª–µ

## üöÄ DEPLOYMENT

**Status:** ‚úÖ Ready for Testing  
**Breaking Changes:** None  
**Migration Required:** No

---

**Next Steps:**
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Vercel –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
3. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

