# üìã –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢ v7.14.8 - Language Filter Fix

**–î–∞—Ç–∞:** 2025-11-03  
**–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** ~30 –º–∏–Ω—É—Ç  
**–¢–∏–ø:** Critical Bugfix

---

## üéØ –ó–ê–î–ê–ß–ê

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤—Å–µ—Ö –≤–µ—Ä—Å–∏–π (–∞–Ω–≥–ª–∏–π—Å–∫–æ–π –∏ –ø–æ–ª—å—Å–∫–æ–π) –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π/—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π —Å—Ç–∞—Ç–µ–π, –∫–æ—Ç–æ—Ä–∞—è —Ä–∞–±–æ—Ç–∞–ª–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º, –Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞ –Ω–∞ –ø–æ–ª—å—Å–∫–æ–º.

---

## üîç –ù–ê–ô–î–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π UX –±–∞–≥:**
- –ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ **–ù–ï —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–ª–∏—Å—å –ø–æ —è–∑—ã–∫—É**
- –ù–∞ `/en` –º–æ–≥–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Å—Ç–∞—Ç—å–∏ —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `-pl`
- –ù–∞ `/pl` –º–æ–≥–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Å—Ç–∞—Ç—å–∏ —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `-en`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥–µ–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —è–∑—ã–∫–µ

**Root Cause:**
```typescript
// lib/supabase-analytics.ts - –ë–´–õ–û:
export async function getPopularArticles(limit: number = 10): Promise<string[]>
// ‚ùå –ù–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ locale - –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏—Å—å —Å—Ç–∞—Ç—å–∏ –æ–±–æ–∏—Ö —è–∑—ã–∫–æ–≤
```

---

## ‚úÖ –í–ù–ï–°–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. **lib/supabase-analytics.ts** ‚≠ê
```typescript
// –°–¢–ê–õ–û:
export async function getPopularArticles(limit: number = 10, locale?: string): Promise<string[]> {
  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —è–∑—ã–∫—É —á–µ—Ä–µ–∑ SQL:
  if (locale) {
    query = query.like('article_slug', `%-${locale}`);
  }
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `locale?: string`
- ‚úÖ SQL —Ñ–∏–ª—å—Ç—Ä: `LIKE '%-en'` –∏–ª–∏ `LIKE '%-pl'`
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –æ–±–æ–∏—Ö —è–∑—ã–∫–æ–≤
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `üåç Filtering for locale: en/pl`

### 2. **app/[locale]/(site)/page.tsx**
```typescript
// –ë–´–õ–û:
const popularSlugs = await getPopularArticles(12);

// –°–¢–ê–õ–û:
const popularSlugs = await getPopularArticles(12, params.locale);
```

### 3. **app/api/analytics/popular-articles/route.ts**
```typescript
// –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ API:
const locale = searchParams.get('locale');

// –í–∞–ª–∏–¥–∞—Ü–∏—è:
if (locale && !['en', 'pl'].includes(locale)) {
  return error;
}

// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:
if (locale) {
  query = query.like('article_slug', `%-${locale}`);
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- `GET /api/analytics/popular-articles?limit=10&locale=en`
- `GET /api/analytics/popular-articles?limit=10&locale=pl`

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### ‚úÖ Build Test
```bash
npm run build
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
```
‚úì Compiled successfully
üåç Filtering 12 articles for locale: en
‚úÖ Article matched for EN: ai-revolution-2024-en
‚úÖ Article matched for EN: apple-vision-pro-review-en
‚úÖ Article matched for EN: gaming-trends-2024-en
üö´ Excluded from EN: ai-revolution-2024-pl (contains non-English characters)
üö´ Excluded from EN: apple-vision-pro-review-pl (contains non-English characters)
üìä Filtered 6/12 articles for en
```

### ‚úÖ TypeScript Check
```
Linting and checking validity of types ... 
‚úì 0 errors
```

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ (`getAllPosts`, `getCategories`, `getRelated`, `getPopularArticles`) –ø–µ—Ä–µ–¥–∞—é—Ç `locale`
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ SQL (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ)
- Fallback —Å–∏—Å—Ç–µ–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –î–æ | –ü–æ—Å–ª–µ |
|----------|-----|-------|
| –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —è–∑—ã–∫—É | ‚ùå –ù–µ—Ç | ‚úÖ –ï—Å—Ç—å |
| –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å—Ç–∞—Ç—å–∏ –Ω–∞ `/en` | ‚ö†Ô∏è –ò–Ω–æ–≥–¥–∞ —Å `-pl` | ‚úÖ –¢–æ–ª—å–∫–æ `-en` |
| –ü–æ–ª—å—Å–∫–∏–µ —Å—Ç–∞—Ç—å–∏ –Ω–∞ `/pl` | ‚ö†Ô∏è –ò–Ω–æ–≥–¥–∞ —Å `-en` | ‚úÖ –¢–æ–ª—å–∫–æ `-pl` |
| UX –∫–∞—á–µ—Å—Ç–≤–æ | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–µ–µ | ‚úÖ –û—Ç–ª–∏—á–Ω–æ–µ |
| API –ø–æ–¥–¥–µ—Ä–∂–∫–∞ locale | ‚ùå –ù–µ—Ç | ‚úÖ –ï—Å—Ç—å |

---

## üéØ –ù–û–í–û–ï –ü–†–ê–í–ò–õ–û –†–ê–ó–†–ê–ë–û–¢–ö–ò

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û –¥–ª—è –≤—Å–µ—Ö –±—É–¥—É—â–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç–æ–∫:**

> **–í—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–Ω–µ–¥—Ä—è—Ç—å –¥–ª—è –î–í–£–• —è–∑—ã–∫–æ–≤ —Å—Ä–∞–∑—É (en –ò pl)**

### –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
- [ ] –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `locale` –≤ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–π –≤–µ—Ä—Å–∏–∏ (`/en`)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ –ø–æ–ª—å—Å–∫–æ–π –≤–µ—Ä—Å–∏–∏ (`/pl`)
- [ ] –ü–µ—Ä–µ–≤–æ–¥—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `lib/i18n.ts`
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É—á–∏—Ç—ã–≤–∞–µ—Ç `-en` –∏ `-pl`
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–∞–µ—Ç —è–∑—ã–∫
- [ ] Build –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
- [ ] TypeScript 0 errors

---

## üìù –ò–ó–ú–ï–ù–ï–ù–ù–´–ï –§–ê–ô–õ–´

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è | –°—Ç—Ä–æ–∫–∏ |
|------|-----------|--------|
| `lib/supabase-analytics.ts` | –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä locale | +25 |
| `app/[locale]/(site)/page.tsx` | –ü–µ—Ä–µ–¥–∞—á–∞ locale | +3 |
| `app/api/analytics/popular-articles/route.ts` | –§–∏–ª—å—Ç—Ä locale | +15 |
| `package.json` | –í–µ—Ä—Å–∏—è 7.14.7 ‚Üí 7.14.8 | +1 |
| `LANGUAGE_FILTER_FIX.md` | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | NEW |
| `RELEASE_v7.14.8.md` | Release notes | NEW |
| `SUMMARY_v7.14.8.md` | –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç | NEW |

**–í—Å–µ–≥–æ:** 7 —Ñ–∞–π–ª–æ–≤, +533 insertions, -19 deletions

---

## üöÄ DEPLOYMENT

```bash
# 1. Build
npm run build              # ‚úÖ Passed

# 2. Git
git add -A
git commit -m "üêõ v7.14.8: Language Filter Fix"
git tag v7.14.8
git push origin main --tags

# 3. Vercel
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π deploy —á–µ—Ä–µ–∑ GitHub integration
# https://app.icoffio.com/en
# https://app.icoffio.com/pl
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ Deployed to Production

---

## üìà –ú–ï–¢–†–ò–ö–ò

- **Time to Fix:** 30 –º–∏–Ω—É—Ç
- **Files Changed:** 7
- **Lines Added:** +533
- **Lines Removed:** -19
- **Build Time:** ~45 —Å–µ–∫—É–Ω–¥
- **TypeScript Errors:** 0
- **Linter Errors:** 0
- **Breaking Changes:** 0
- **Migration Required:** 0

---

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –ß–ï–ö–õ–ò–°–¢

- [x] –ü—Ä–æ–±–ª–µ–º–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞
- [x] Root cause –Ω–∞–π–¥–µ–Ω
- [x] –†–µ—à–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –¥–ª—è –æ–±–æ–∏—Ö —è–∑—ã–∫–æ–≤ (en + pl)
- [x] Build –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
- [x] TypeScript 0 errors
- [x] –¢–µ—Å—Ç—ã –≤ –ª–æ–≥–∞—Ö –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É
- [x] API –æ–±–Ω–æ–≤–ª–µ–Ω
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [x] –í–µ—Ä—Å–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (7.14.8)
- [x] –ö–æ–º–º–∏—Ç —Å–æ–∑–¥–∞–Ω
- [x] –¢–µ–≥ —Å–æ–∑–¥–∞–Ω
- [x] Pushed to GitHub
- [x] –ü—Ä–∞–≤–∏–ª–æ –Ω–∞ –±—É–¥—É—â–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ
- [x] TODO –∑–∞–≤–µ—Ä—à–µ–Ω—ã

---

## üéâ –†–ï–ó–£–õ–¨–¢–ê–¢

**–ü—Ä–æ–±–ª–µ–º–∞ –ü–û–õ–ù–û–°–¢–¨–Æ —Ä–µ—à–µ–Ω–∞:**
- ‚úÖ –ê–Ω–≥–ª–∏–π—Å–∫–∞—è –≤–µ—Ä—Å–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å—Ç–∞—Ç—å–∏
- ‚úÖ –ü–æ–ª—å—Å–∫–∞—è –≤–µ—Ä—Å–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ–ª—å—Å–∫–∏–µ —Å—Ç–∞—Ç—å–∏
- ‚úÖ API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ —è–∑—ã–∫—É
- ‚úÖ UX –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω
- ‚úÖ –ü—Ä–∞–≤–∏–ª–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –¥–≤—É—Ö —è–∑—ã–∫–æ–≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ production

---

**–í–µ—Ä—Å–∏—è:** v7.14.8  
**Semantic Versioning:** PATCH (bugfix)  
**Breaking Changes:** –ù–µ—Ç  
**Migration:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

**–°–ª–µ–¥—É—é—â–∞—è –≤–µ—Ä—Å–∏—è:** v7.14.9 –∏–ª–∏ v7.15.0 (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å–ª–µ–¥—É—é—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)





